<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Laundry Wizard 5.0 </title>
    <style>
        /* --- THE SETUP --- */
        body { 
            font-family: 'Segoe UI', sans-serif; 
            margin: 0; 
            height: 100vh; 
            overflow: hidden; 
            background: linear-gradient(to bottom, #87CEEB, #E0F7FA); 
            transition: background 1s ease;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- THE APP CARD --- */
        .app-card { 
            position: relative;
            z-index: 10; 
            background: rgba(255, 255, 255, 0.95); 
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.2); 
            width: 450px;
            text-align: center;
        }

        input { padding: 12px; border: 2px solid #ddd; border-radius: 10px; width: 60%; font-size: 1rem; }
        .search-btn { padding: 12px; background: #2196F3; color: white; border: none; border-radius: 10px; cursor: pointer; }
        
        .wardrobe { display: flex; gap: 10px; justify-content: center; margin-top: 20px; flex-wrap: wrap; }
        
        .item-btn { 
            padding: 10px 15px; background: white; border: 2px solid #eee; border-radius: 10px; cursor: pointer; transition: 0.2s; 
        }
        .item-btn:hover { background: #E3F2FD; transform: scale(1.05); }

        #weather-display { margin-top: 15px; font-size: 0.9rem; color: #555; background: #f1f1f1; padding: 10px; border-radius: 10px; }
        
        /* The result box is hidden by default */
        #result { margin-top: 20px; font-size: 1.2rem; font-weight: bold; padding: 15px; border-radius: 10px; display: none; }
        
        .warning { background-color: #ffebee; color: #c62828; border: 1px solid #ffcdd2; }
        .success { background-color: #e8f5e9; color: #2e7d32; border: 1px solid #c8e6c9; }

        /* --- ANIMATION EFFECTS --- */
        .effect-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; overflow: hidden; }
        
        .raindrop { position: absolute; background: #0055ff; width: 2px; height: 15px; top: -20px; animation: fall linear infinite; opacity: 0.6; }
        .snowflake { position: absolute; background: white; width: 8px; height: 8px; border-radius: 50%; top: -10px; animation: fall linear infinite; opacity: 0.8; }
        .cloud { position: absolute; background: rgba(255,255,255,0.8); border-radius: 50px; animation: floatCloud linear infinite; }

        @keyframes fall { to { transform: translateY(105vh); } }
        @keyframes floatCloud { from { transform: translateX(-200px); } to { transform: translateX(110vw); } }

    </style>
</head>
<body>

<div id="effects" class="effect-layer"></div>

<div class="app-card">
    <h1>üå§Ô∏è Laundry Wizard 5.0</h1>
    
    <div>
        <input type="text" id="cityInput" placeholder="Enter Location (e.g. London)">
        <button class="search-btn" onclick="getWeather()">üöÄ Go</button>
    </div>

    <div id="weather-display">Type a city to check the atmosphere...</div>

    <div class="wardrobe">
        <button class="item-btn" onclick="calculate('T-Shirt', 1800)">üëï T-Shirt</button>
        <button class="item-btn" onclick="calculate('Jeans', 4500)">üëñ Jeans</button>
        <button class="item-btn" onclick="calculate('Towel', 5500)">üßº Towel</button>
        <button class="item-btn" onclick="calculate('Sheet', 1200)">üõèÔ∏è Sheet</button>
    </div>

    <div id="result"></div>
</div>

<script>
    let temp = null;
    let humidity = null;
    let wind = null;
    let weatherCode = 0;

    async function getWeather() {
        let city = document.getElementById('cityInput').value;
        if (!city) return alert("Please type a location!");

        // --- BUG FIX HERE ---
        // Hide the old result immediately when we start a new search!
        document.getElementById('result').style.display = 'none';
        
        document.getElementById('weather-display').innerText = "üì° Connecting to satellites...";
        clearEffects();

        try {
            let geoReq = await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1&language=en&format=json`);
            let geoData = await geoReq.json();
            if (!geoData.results) throw new Error("City not found");

            let lat = geoData.results[0].latitude;
            let long = geoData.results[0].longitude;

            let apiURL = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${long}&current_weather=true&hourly=relativehumidity_2m,surface_pressure`;
            let weatherReq = await fetch(apiURL);
            let weatherData = await weatherReq.json();

            temp = weatherData.current_weather.temperature;
            wind = weatherData.current_weather.windspeed;
            weatherCode = weatherData.current_weather.weathercode;
            humidity = weatherData.hourly.relativehumidity_2m[0];

            updateDisplay(geoData.results[0].name);
            setVibe(weatherCode); 

        } catch (err) {
            document.getElementById('weather-display').innerText = "‚ùå Uh oh! Couldn't find that place.";
        }
    }

    function updateDisplay(cityName) {
        document.getElementById('weather-display').innerHTML = `
            <b>${cityName}</b> Details:<br>
            üå°Ô∏è Temp: ${temp}¬∞C | üíß Humidity: ${humidity}%<br>
            üí® Wind: ${wind} km/h
        `;
    }

    function setVibe(code) {
        let body = document.body;
        // Reset background
        body.style.background = "linear-gradient(to bottom, #87CEEB, #E0F7FA)"; 

        if (code <= 3) {
             createClouds();
             if (code >= 2) body.style.background = "#cfd8dc"; 
        } else if (code >= 51 && code <= 67) {
            body.style.background = "#455a64"; 
            createParticles('rain');
        } else if (code >= 71 && code <= 86) {
            body.style.background = "#b0bec5"; 
            createParticles('snow');
        }
    }

    function createParticles(type) {
        const container = document.getElementById('effects');
        const count = type === 'rain' ? 100 : 50;
        for (let i = 0; i < count; i++) {
            let p = document.createElement('div');
            p.classList.add(type === 'rain' ? 'raindrop' : 'snowflake');
            p.style.left = Math.random() * 100 + 'vw';
            p.style.animationDuration = (Math.random() * 1 + 0.5) + 's';
            p.style.opacity = Math.random();
            container.appendChild(p);
        }
    }

    function createClouds() {
        const container = document.getElementById('effects');
        for (let i = 0; i < 5; i++) {
            let c = document.createElement('div');
            c.classList.add('cloud');
            c.style.width = (100 + Math.random() * 200) + 'px';
            c.style.height = (50 + Math.random() * 50) + 'px';
            c.style.top = (Math.random() * 50) + 'vh';
            c.style.animationDuration = (10 + Math.random() * 20) + 's';
            container.appendChild(c);
        }
    }

    function clearEffects() {
        document.getElementById('effects').innerHTML = "";
    }

    function calculate(item, kValue) {
    if (temp === null) return alert("Search for a location first!");

    let resultBox = document.getElementById('result');
    
    // --- 1. SAFETY CHECKS (Temperature / Hurricane / Rain / Snow) ---
    if (temp < 0) {
        resultBox.className = "warning";
        resultBox.style.display = "block";
        resultBox.innerHTML = `‚ùÑÔ∏è <b>TOO COLD!</b><br>Temperature is ${temp}¬∞C.<br>It is too cold to dry your ${item} outside!`;
        return;
    }

    if (wind > 50) {
        resultBox.className = "warning";
        resultBox.style.display = "block";
        resultBox.innerHTML = `üå¨Ô∏è <b>DANGER!</b><br>Wind is ${wind} km/h!<br>Your ${item} will fly away!`;
        return;
    }

    if ((weatherCode >= 51 && weatherCode <= 67) || (weatherCode >= 71 && weatherCode <= 86) || weatherCode >= 95) {
        resultBox.className = "warning";
        resultBox.style.display = "block";
        resultBox.innerHTML = `‚ö†Ô∏è <b>NOT SUITABLE!</b><br>It is raining or snowing.<br>Dry your ${item} inside!`;
        return;
    }

    // --- 2. THE DRYING FORMULA ---
    // Formula: T = K / (Temp * (1 - RH) * (1 + 0.1 * W))
    let rhDecimal = humidity / 100;
    
    // Prevent division by zero if humidity is 100%
    if (rhDecimal >= 1) rhDecimal = 0.99; 

    let time = kValue / (temp * (1 - rhDecimal) * (1 + 0.1 * wind));

    // --- 3. PERFECT CONDITIONS CHECK ---
    // Criteria: Sun (Code 0-1), RH < 70%, Temp >= 21, Wind 12.8-19.3 km/h (8-12 mph)
    let isPerfect = (weatherCode <= 1) && (humidity < 70) && (temp >= 21) && (wind >= 12.8 && wind <= 19.3);

    // --- 4. DISPLAY LOGIC ---
    let message = "";
    if (isPerfect) {
        message = `‚ú® <b>PERFECT DRYING CONDITIONS!</b><br>`;
    }

    if (time > 480) { // Over 8 hours
        resultBox.className = "warning";
        resultBox.innerHTML = `‚ö†Ô∏è <b>Very Slow Drying.</b><br>It will take over 8 hours to dry your ${item}.`;
    } else {
        resultBox.className = "success";
        let timeDisplay = time > 60 ? `${(time / 60).toFixed(1)} hours` : `${Math.round(time)} minutes`;
        resultBox.innerHTML = `${message}‚úÖ <b>Good to go!</b><br>Your <b>${item}</b> will dry in about<br><b>${timeDisplay}</b>.`;
    }
    
    resultBox.style.display = "block";
}
</script>

</body>
</html>